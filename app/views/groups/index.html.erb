<% caching_hash = {:action => params[:action], :f => iphone_user_agent?, :l => @l, :i => @i}%>
<% if params[:action] == 'index' %>
  <% caching_hash[:part] = 'left_column' %>
  <% cache (caching_hash) do %>
    <div class="col1">
      <ul class="module">
        <li><div class="pagelabel"><%= selection %></div></li>
        <li><%= render :partial => @haufens %></li>
      </ul>
      <% if @top_politics_haufens.size > 0 %>
        <ul class="module">
          <li><div class="pagelabel"> <%= link_to politics_label, :action => 'politics', :l => @l  %> </div></li>
          <li><%= render :partial => @top_politics_haufens %></li>
        </ul>
      <% end %>
      <% if @top_business_haufens.size > 0 %>
        <ul class="module">
          <li><div class="pagelabel"><%= link_to business_label, :action => 'business', :l => @l  %></div></li>
          <li><%= render :partial => @top_business_haufens %></li>
        </ul>
      <% end %>

      <% if @top_culture_haufens.size > 0 %>
        <ul class="module">
          <li><div class="pagelabel"> <%= link_to culture_label, :action => 'culture', :l => @l  %></div></li>
          <li><%= render :partial => @top_culture_haufens %></li>
        </ul>
      <% end %>

      <% if @top_science_haufens.size > 0 %>
        <ul class="module">
          <li><div class="pagelabel"> <%= link_to science_label, :action => 'science', :l => @l  %></div></li>
          <li><%= render :partial => @top_science_haufens %></ul>
        </ul>
      <% end %>
      <% if @top_technology_haufens.size > 0 %>
        <ul class="module">
          <li><div class="pagelabel"> <%= link_to technology_label, :action => 'technology', :l => @l  %></div></li>
          <li><%= render :partial => @top_technology_haufens %></li>
        </ul>
      <% end %>
      <% if @top_sport_haufens.size > 0 %>
        <ul class="module">
          <li><div class="pagelabel"> <%= link_to sport_label, :action => 'sport', :l => @l  %></div></li>
          <li><%= render :partial => @top_sport_haufens %></li>
        </ul>
      <% end %>
      <% if @top_mixed_haufens.size > 0 %>
        <ul class="module">
          <li><div class="pagelabel"> <%= link_to mixed_label, :action => 'mixed', :l => @l  %></div></li>
          <li><%= render :partial => @top_mixed_haufens %></li>
        </ul>
      <% end %>
    </div>
  <% end %>
  <div class="col2">
    <%= render :partial => '/users/notifications'-%>
    <%# Latest two profile actions Start %>
    <% if logged_in? %>
      <% latest_pa = @current_user.jurnalo_friends_profile_actions(2, true) %>
      <% unless latest_pa.blank? %>
        <ul class="module">
          <li><div class="pagelabel"><%= link_to friends_label, :controller => 'users' , :action => 'friends_actions', :l => @l -%></div></li>
          <li>
            <% latest_pa.each_with_index do |pa, i| %>
              <%= render :partial => pa, :locals => {:user => latest_pa.find_all{|u| u.id == pa.user_id}.first, :no_spacer => (i == (latest_pa.size - 1) )} -%>
            <% end %>
          </li>
        </ul>
      <% end %>
    <% end %>
    <%# Latest two profile actions End %>
    <% caching_hash[:part] = 'opinions' %>
    <% cache (caching_hash) do %>
      <% if @top_opinions_haufens.size > 0 %>
        <ul class="module">
          <li><div class="pagelabel"> <%= link_to opinions_label, :action => 'opinions', :l => @l  %></div></li>
          <li><%= render :partial => @top_opinions_haufens %></li>
        </ul>
      <% end %>

    <% end %>
    <ul class="module">
      <% if logged_in? -%>
        <li>
          <div class="pagelabel">
            <%= link_to my_authors, :controller => 'users', :action => 'articles_by_favorite_authors', :l => @l  %>
            <% if @current_user.subscriptions.size > 0 and @top_my_authors.size == 0 -%>
              &nbsp;&nbsp;
              <% if @language == 2 %><%= 'Heute nichts Neues'  %><%else%><%= 'No news today' %><%end%>
            <%end%>
          </div>
        </li>
        <% if @current_user.subscriptions.size > 0  -%>
          <% if @top_my_authors.size > 0 %>
          <li>
            <%= render :partial => @top_my_authors %>
          </li>
          <% end %>
        <% else %>
          <li>
            <div class="message">
              <% if @language == 2 %>
                <%= 'Sie haben noch keine Lieblingsautoren.' %><br><br>
                <%= 'Klicken Sie auf das ' + image_tag('plus.gif') + ' neben dem Namen um einen Autoren hinzuzufÃ¼gen.'  %>
              <% else %>
                <%= 'You don\'t have any favourite authors yet.' %> <br><br>
                <%= 'Click the ' + image_tag('plus.gif') + ' next to the name to add an author.'  %>		
              <% end %>
            </div>
          </li>
        <% end -%>
      <% else -%>
        <li><div class="pagelabel"> <%= link_to my_authors, :controller => 'users', :action => 'articles_by_favorite_authors', :l => @l  %></div></li>
        <li>
          <div class="message">
            <% if @language == 2 %>
              <%= 'Sammeln Sie Ihre Lieblingsautoren!'  %> <br><%= link_to 'Registrieren', :controller => 'users', :action => 'new', :l=>@l %> &nbsp;-&nbsp; <%= link_to 'Einloggen', :controller => 'sessions', :action => 'new', :l=>@l %> 
            <% else %>
              <%= 'Start adding your favorite authors!'  %> <br> <%= link_to 'Sign up', :controller => 'users', :action => 'new', :l=>@l %> &nbsp;-&nbsp; <%= link_to 'Login', :controller => 'sessions', :action => 'new', :l=>@l %> 	
            <% end %>
          </div>
        </li>
      <% end -%>
    </ul>
    <% if @searchterms %>
      <% @searchterms.each do |s| %>
        <% cache({:action => 'index', :part => 'topic', :f => iphone_user_agent?, :l => @l, :i => @i, :s => s}) do %>
          <ul class="module">
            <li>
              <div class="pagelabel">
                <%= link_to h(s), search_rawstories_path(:l => @l, :q => s)  %>
                &nbsp;&nbsp;
                <%= link_to '[ - ]',  :controller => 'topics', :action => 'delete', :q => s, :l => @l  %>
                <% if @top_my_searchterms[s].size == 0 %>
                  &nbsp;&nbsp;
                  <% if @language == 2 %>
                  <%= 'Heute nichts Neues'  %>
                  <%else%>
                  <%= 'No news today' %>
                  <%end%>
                <% end %>
              </div>
            </li>
            <% if @top_my_searchterms[s].size > 0 %>
              <% if s != nil %>
                <li><%= render :partial => @top_my_searchterms[s] %></li>
              <% end %>
            <% end %>		
          </ul>
        <% end %>
      <% end %>
      <ul class="module">
        <li><div class="pagelabel"> <%= link_to create_topic, :controller => 'topics', :action => 'new', :l => @l  %></div></li>
        <li>
        <% if @searchterms.size == 0 %>
          <div class = 'message'>		
            <% if @language == 2 %>
              <%= link_to 'Eigene Themen erstellen!', :controller => 'topics', :action => 'new', :l => @l  %>
            <%else%>
              <%= link_to 'Create your own topics!', :controller => 'topics', :action => 'new', :l => @l  %>
            <%end%>
          </div>
        <%end%>
        </li>
      </ul>
    <% else %>
      <ul class="module">
        <li><div class="pagelabel"><%= link_to create_topic, :controller => 'topics', :action => 'new', :l => @l  %></div></li>
        <li>
          <div class = 'message'>		
            <% if @language == 2 %>
              <%= 'Erstellen Sie Ihre eigenen Themen!' %><br><%= link_to 'Registrieren', :controller => 'users', :action => 'new', :l=>@l %> &nbsp;-&nbsp; <%= link_to 'Einloggen', :controller => 'sessions', :action => 'new', :l=>@l %> 
            <% else %>
              <%= 'Create your own topics!' %><br><%= link_to 'Sign up', :controller => 'users', :action => 'new', :l=>@l %> &nbsp;-&nbsp; <%= link_to 'Login', :controller => 'sessions', :action => 'new', :l=>@l %> 
            <%end%>
          </div>
        </li>
      </ul>
    <%end%>
  </div>
<% end %>

<% if params[:action] != 'index' %>
  <% caching_hash.delete(:part) 
     caching_hash[:page] =  params[:page] || 1 %>
  <% cache (caching_hash) do %>
    <li>
      <div class="pagelabel"><%= selection %>
        <% if params[:action] == 'opinions' -%>
        ( <%= articles_list_label -%> - <%= link_to author_ranking_label, author_ranking_path(:l => @l)%> )
        <% end -%>
      </div>
    </li>
    <li><%= render :partial => @haufens -%></li>
    <li>
      <div class="pagination">
        <%= will_paginate(@haufens, options = {:prev_label => previous_label + '&nbsp -&nbsp', :next_label => ' &nbsp;-&nbsp; ' + next_label}) %>
      </div>
    </li>
  <% end %>
<% end %>





		







